# React Flow 工作流设计器使用指南

## 概述

本项目集成了 React Flow 库来提供可视化的工作流设计功能。React Flow 是一个强大的 React 库，专门用于构建节点编辑器和工作流设计器。

## 功能特性

### 🎯 核心功能
- **可视化节点编辑**: 拖拽式节点创建和编辑
- **连线管理**: 节点之间的连接和关系管理
- **实时预览**: 工作流结构的实时可视化
- **交互操作**: 双击编辑、右键删除等交互功能

### 🎨 界面特性
- **自定义节点**: 不同类型节点使用不同颜色标识
- **控制面板**: 缩放、平移、小地图等控制功能
- **响应式设计**: 适配不同屏幕尺寸
- **Ant Design 集成**: 统一的UI风格

## 使用方法

### 1. 访问设计器
- 登录系统后，在左侧菜单选择 "工作流" → "React Flow 设计器"
- 或者访问 "工作流" → "React Flow 演示" 查看基础功能

### 2. 创建工作流
1. 点击 "创建新工作流" 按钮
2. 输入工作流名称和描述
3. 选择新创建的工作流开始设计

### 3. 添加节点
1. 点击 "添加节点" 按钮
2. 在弹出的模态框中填写：
   - **节点名称**: 节点的显示名称
   - **节点类型**: 选择 start（开始）、processor（处理器）、end（结束）
   - **节点描述**: 节点的详细描述
3. 点击确定保存节点

### 4. 连接节点
- 从一个节点的输出端口拖拽到另一个节点的输入端口
- 自动创建连接线
- 支持删除连接线

### 5. 编辑节点
- **双击节点**: 打开编辑模态框
- **右键节点**: 删除节点
- **拖拽节点**: 调整节点位置

### 6. 保存和执行
- 点击 "保存工作流" 将设计保存到后端
- 点击 "执行工作流" 启动工作流执行

## 节点类型说明

### 🟢 开始节点 (Start)
- 工作流的入口点
- 绿色边框标识
- 只能有一个开始节点

### 🔵 处理器节点 (Processor)
- 执行具体任务的节点
- 蓝色边框标识
- 可以分配处理器（用户或Agent）

### 🔴 结束节点 (End)
- 工作流的出口点
- 红色边框标识
- 可以有多个结束节点

## 技术实现

### 组件结构
```
ReactFlowDesigner/
├── ReactFlowDesigner.tsx    # 主设计器组件
├── ReactFlowTest.tsx        # 测试组件
└── ReactFlowDemo.tsx        # 演示页面
```

### 主要依赖
- `reactflow`: 核心流程图库
- `antd`: UI组件库
- `axios`: API请求库

### API集成
- 工作流管理: `workflowAPI`
- 节点操作: `nodeAPI`
- 处理器管理: `processorAPI`
- 工作流执行: `executionAPI`

## 开发指南

### 添加新的节点类型
1. 在 `CustomNode` 组件中添加新的颜色映射
2. 在节点类型选择器中添加新选项
3. 在后端添加相应的节点类型支持

### 自定义节点样式
```typescript
const CustomNode = ({ data }: { data: any }) => {
  const nodeStyle = {
    padding: '10px',
    borderRadius: '8px',
    border: '2px solid #d9d9d9',
    backgroundColor: '#fff',
    minWidth: '150px',
    textAlign: 'center' as const,
  };
  
  // 自定义样式逻辑
  return (
    <div style={nodeStyle}>
      {/* 节点内容 */}
    </div>
  );
};
```

### 扩展功能
- 添加节点验证规则
- 实现节点配置面板
- 添加工作流模板功能
- 支持导入/导出工作流

## 注意事项

1. **浏览器兼容性**: 需要现代浏览器支持
2. **性能考虑**: 大量节点时注意性能优化
3. **数据同步**: 确保前后端数据一致性
4. **错误处理**: 添加适当的错误提示和处理

## 故障排除

### 常见问题
1. **节点无法拖拽**: 检查ReactFlowProvider是否正确包装
2. **连接线不显示**: 确认节点有正确的输入/输出端口
3. **样式异常**: 检查CSS样式是否正确加载

### 调试技巧
- 使用浏览器开发者工具检查控制台错误
- 查看网络请求确认API调用正常
- 检查React Flow的调试模式

## 更新日志

### v1.0.0 (2025-07-25)
- ✅ 基础节点创建和编辑功能
- ✅ 节点连接和删除功能
- ✅ 工作流保存和执行功能
- ✅ 自定义节点样式
- ✅ 与后端API集成

---

更多信息请参考 [React Flow 官方文档](https://reactflow.dev/) 