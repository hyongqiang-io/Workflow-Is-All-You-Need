# 任务流程可视化功能指南

## 🎯 功能概述

任务流程可视化功能允许不同角色的用户查看工作流的任务分配和执行状态：

- **创建者（Creator）**：可以看到完整的工作流程图和所有任务状态
- **被分配者（Assignee）**：可以看到分配给自己的任务，并直接操作

## 🚀 主要特性

### 1. 角色区分视图
- **创建者视图**：所有任务节点高亮显示，可以监控整个工作流
- **执行者视图**：分配给当前用户的任务高亮显示，可以直接操作

### 2. 实时任务操作
- 开始任务
- 完成任务
- 暂停任务
- 查看任务详情

### 3. 可视化流程图
- 使用ReactFlow实现的可视化流程图
- 支持缩放、拖拽、平移
- 节点状态颜色区分
- 任务类型图标显示

### 4. 任务统计信息
- 总任务数
- 已完成任务数
- 进行中任务数
- 待处理任务数
- 整体进度条

## 📁 文件结构

```
frontend/
├── src/
│   ├── components/
│   │   └── TaskFlowViewer.tsx          # 任务流程可视化组件
│   ├── pages/
│   │   └── Workflow/
│   │       ├── Workflow.tsx            # 工作流列表页面
│   │       └── TaskFlow.tsx            # 任务流程页面
│   └── services/
│       └── api.ts                      # API服务（包含任务流程API）

workflow_framework/
└── api/
    └── execution.py                    # 执行API（包含任务流程接口）
```

## 🔧 技术实现

### 1. 前端组件

#### TaskFlowViewer.tsx
- 使用ReactFlow实现流程图可视化
- 自定义节点组件支持任务操作
- 实时状态更新和交互
- 响应式设计

#### TaskFlow.tsx
- 任务流程页面容器
- 工作流统计信息展示
- 使用说明和帮助信息

### 2. 后端API

#### 任务流程API
```python
@router.get("/workflow/{workflow_id}/task-flow")
async def get_workflow_task_flow(workflow_id: uuid.UUID, current_user: CurrentUser)
```

#### 任务操作API
```python
@router.post("/tasks/{task_id}/start")
@router.post("/tasks/{task_id}/complete")
@router.post("/tasks/{task_id}/pause")
```

### 3. 数据结构

#### TaskNode接口
```typescript
interface TaskNode {
  id: string;
  name: string;
  description: string;
  type: 'start' | 'process' | 'decision' | 'end' | 'human' | 'ai';
  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'blocked';
  assignee?: {
    id: string;
    name: string;
    type: 'user' | 'agent';
  };
  position: { x: number; y: number };
  estimated_duration?: number;
  actual_duration?: number;
  created_at: string;
  started_at?: string;
  completed_at?: string;
}
```

## 🎨 界面设计

### 1. 节点类型图标
- 🟢 **开始节点**：绿色播放图标
- 🔴 **结束节点**：红色停止图标
- 👤 **人工任务**：蓝色用户图标
- 🤖 **AI任务**：紫色机器人图标
- 🔀 **决策节点**：橙色分支图标

### 2. 状态颜色
- 🟡 **待处理**：橙色
- 🔵 **进行中**：蓝色
- 🟢 **已完成**：绿色
- 🔴 **失败**：红色
- 🟣 **阻塞**：紫色

### 3. 高亮显示
- **创建者**：所有节点都有蓝色边框高亮
- **执行者**：分配给自己的任务有蓝色边框高亮

## 📱 使用方法

### 1. 访问任务流程
1. 登录系统
2. 进入工作流页面
3. 点击工作流的"任务流程"按钮
4. 进入任务流程可视化页面

### 2. 创建者操作
- 查看完整的工作流程图
- 监控所有任务的执行状态
- 点击节点查看详细信息
- 查看工作流统计信息

### 3. 执行者操作
- 查看分配给自己的任务（高亮显示）
- 在节点上直接操作任务：
  - 点击"开始任务"按钮开始执行
  - 点击"完成任务"按钮完成任务
  - 点击"暂停"按钮暂停任务
- 在下方查看自己的任务列表
- 点击节点查看任务详情

### 4. 任务详情查看
- 点击任意节点查看详细信息
- 包括任务名称、描述、类型、状态
- 执行者信息、时间信息、耗时统计

## 🔄 工作流程

### 1. 任务分配流程
1. 工作流创建者设计工作流
2. 为每个节点分配执行者（用户或Agent）
3. 启动工作流执行
4. 系统创建任务实例

### 2. 任务执行流程
1. 执行者查看分配给自己的任务
2. 开始执行任务
3. 完成任务或暂停任务
4. 系统更新任务状态
5. 触发下一个任务的开始

### 3. 状态更新流程
1. 用户操作任务（开始/完成/暂停）
2. 前端发送API请求
3. 后端更新数据库
4. 返回更新结果
5. 前端刷新显示

## 🛠️ 扩展功能

### 1. 实时更新
- WebSocket连接实现实时状态更新
- 多用户同时操作时的状态同步

### 2. 任务评论
- 为任务添加评论和反馈
- 支持@用户和文件附件

### 3. 任务依赖
- 支持复杂的任务依赖关系
- 条件分支和并行执行

### 4. 任务模板
- 预定义的任务模板
- 快速创建工作流

### 5. 移动端支持
- 响应式设计适配移动设备
- 触摸友好的交互界面

## 🎯 最佳实践

### 1. 任务设计
- 任务粒度要适中，不要过于复杂
- 明确任务的前置条件和后置结果
- 合理估计任务耗时

### 2. 角色分配
- 根据用户能力分配任务
- 考虑工作负载平衡
- 设置任务优先级

### 3. 状态管理
- 及时更新任务状态
- 记录任务执行日志
- 处理异常情况

### 4. 用户体验
- 提供清晰的操作指引
- 及时反馈操作结果
- 优化页面加载速度

## 🔍 故障排除

### 1. 常见问题
- **节点不显示**：检查节点位置坐标
- **状态不更新**：检查API调用是否成功
- **权限错误**：确认用户角色和权限

### 2. 调试方法
- 查看浏览器控制台错误信息
- 检查网络请求状态
- 查看后端日志

### 3. 性能优化
- 使用虚拟化处理大量节点
- 实现节点懒加载
- 优化API响应时间

---

通过这个任务流程可视化功能，用户可以：
- 直观地了解工作流的执行状态
- 快速定位和处理自己的任务
- 实时监控工作流进度
- 提高团队协作效率

这个功能为工作流管理提供了强大的可视化支持，让复杂的业务流程变得简单易懂！🎉 